# Landnote 專案操作手冊

本手冊說明如何使用重構後的 Landnote 爬蟲系統。

## 1. 系統架構簡介

重構後的系統採用模組化設計，位於 `src/landnote` 目錄下：

- **統一入口**：所有功能透過 `src/landnote/main.py` 執行。
- **爬蟲模組**：
  - `articles`：房地產文章爬蟲 (原 `getlandarticle.py`)
  - `exams`：地政/法律考古題下載 (原 `download_exam.py`, `getlawarticle.py`)
- **處理模組**：
  - `group`：文章分組與報表生成 (原 `group_similar_titles.py`)

舊有的獨立腳本 (`getlandarticle.py`, `download_exam.py` 等) 已被移除，請改用新的指令操作。

## 2. 安裝與環境設定

確保您的環境已安裝 Python 3.10 或更高版本。

### 步驟 1：安裝依賴套件

在專案根目錄 (`landnotev3`) 執行以下指令安裝所有必要套件：

```bash
# 使用 pip 安装
pip install requests pandas beautifulsoup4 pikepdf tqdm openpyxl Pillow fake-useragent urllib3 python-dotenv fuzzywuzzy python-Levenshtein reportlab
```

## 2. 自動化排程 (GitHub Actions)

本專案已設定 GitHub Actions，將於**每週二、每週四**的台北時間約 08:00 自動執行文章更新與報表生成。

### 運作方式

1. GitHub Actions 啟動虛擬環境 (Ubuntu)。
2. 安裝 Python 環境與中文字型 (`fonts-noto-cjk`)。
3. 執行爬蟲更新文章。
4. 執行分組與生成 PDF。
5. 若有新內容，自動 Commit 並 Push 回儲存庫。

### 如何查看

1. 前往 GitHub Repository 的 **Actions** 頁籤。
2. 點選 "Landnote Auto Update" workflow 查看執行紀錄。
3. 若有更新，您可以直接在 Code 頁面查看 `data/` 目錄下的新檔案。

### 手動觸發

若您想立即更新，也可以手動觸發：

1. 前往 GitHub **Actions** > **Landnote Auto Update**。
2. 點選右側的 **Run workflow** 按鈕。

## 3. 操作指令說明

所有指令皆透過 `python src/landnote/main.py` 執行。

### 3.1 房地產文章爬蟲 (Articles)

用於爬取曾榮耀、許文昌等老師的專欄文章。

**指令格式**：

```bash
python src/landnote/main.py articles [選項]
```

**常用範例**：

1. **僅更新新文章** (推薦日常使用)：

   ```bash
   python src/landnote/main.py articles --update
   ```

   *說明：系統會檢查是否已有文章，只下載新的。*

2. **完整重新爬取** (耗時较長)：

   ```bash
   python src/landnote/main.py articles
   ```

   *說明：重新掃描所有頁面並下載。*

3. **爬取後自動分組**：

   ```bash
   python src/landnote/main.py articles --update --auto-group
   ```

   *說明：爬取完成後自動執行文章分組與 PDF 生成。*

---

### 3.2 考古題下載 (Exams)

支援「地政」與「法律」兩大類考古題下載與 PDF 解鎖。

**指令格式**：

```bash
python src/landnote/main.py exams --type [land|law] [選項]
```

**常用範例**：

1. **下載地政考古題 (最近 5 年)**：

   ```bash
   python src/landnote/main.py exams --type land --years 5 --update
   ```

   *說明：下載最近 5 年的地政考古題，`--update` 參數會跳過已存在的檔案。*

2. **下載法律考古題 (指定頁數)**：

   ```bash
   python src/landnote/main.py exams --type law --max-pages 5
   ```

   *說明：爬取法律考古題列表的前 5 頁並下載 PDF。*

---

### 3.3 文章分組與報表 (Group)

將下載的房地產文章依「標題相似度」與「關鍵詞」進行分組，並生成合併的 PDF 與 Markdown 報表。

**指令格式**：

```bash
python src/landnote/main.py group [選項]
```

**常用範例**：

1. **執行預設分組**：

   ```bash
   python src/landnote/main.py group
   ```

   *說明：使用預設相似度閾值 (80) 進行分組。*

2. **指定相似度閾值**：

   ```bash
   python src/landnote/main.py group --threshold 90
   ```

   *說明：設定更嚴格的相似度標準 (90)，標題需非常相似才會分在同一組。*

## 4. 輸出檔案位置

執行後的檔案將儲存在 `data/` 目錄下：

- `data/real_estate_articles/`：
  - `articles/`：原始 Markdown 文章 (含圖片)
  - `merged/`：分組後的合併檔案 (PDF/MD)
  - `keywords/`：依關鍵詞分類的檔案 (PDF/MD)
  - `pdf/`：按年份彙整的 PDF
  - `README_grouped.md`：分組索引檔
- `data/地政考古題/`：下載的地政考古題 PDF 與分類資料夾。
- `data/高點法律考古題/`：下載的法律考古題 PDF。

## 5. 常見問題排除

1. **缺少模組錯誤 (ModuleNotFoundError)**：
   若出現 `No module named 'xxx'`，請確認是否已執行步驟 1 的 `pip install` 指令。

2. **PDF 生成失敗**：
   若出現字型相關錯誤，系統會自動嘗試使用系統內建字型或備援字型。若仍有問題，請確認作業系統是否有安裝中文字型 (如微軟正黑體)。

3. **Jasper 爬蟲**：
   根目錄下的 `jasper.py` 為獨立運作的腳本，不包含在 `main.py` 流程中。如需執行，請直接使用 `python jasper.py` (需額外安裝 `fpdf`, `markdown`)。
